Subject: [PATCH] secret and configmap
---
Index: k8s-db.yaml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/k8s-db.yaml b/k8s-db.yaml
--- a/k8s-db.yaml	(revision 90ab50ff4f539137a8e369097375a1a7094dbdf0)
+++ b/k8s-db.yaml	(date 1741879391524)
@@ -40,9 +40,15 @@
             - containerPort: 3306
           env:
             - name: MYSQL_ROOT_PASSWORD
-              value: "rootPassword"
+              valueFrom:
+                secretKeyRef:
+                  name: mysql-secret
+                  key: password
             - name: MYSQL_DATABASE
-              value: "unibank"
+              valueFrom:
+                configMapKeyRef:
+                  name: db-config
+                  key: dbName
           volumeMounts:
             - name: mysql-storage
               mountPath: /var/lib/mysql
Index: k8s-config.yaml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/k8s-config.yaml b/k8s-config.yaml
new file mode 100644
--- /dev/null	(date 1741939475377)
+++ b/k8s-config.yaml	(date 1741939475377)
@@ -0,0 +1,14 @@
+apiVersion: v1
+kind: Namespace
+metadata:
+  name: card-app-namespace
+---
+
+apiVersion: v1
+kind: ConfigMap
+metadata:
+  name: db-config
+  namespace: card-app-namespace
+data:
+  host: mysql-service
+  dbName: unibank
Index: secrets.yaml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/secrets.yaml b/secrets.yaml
new file mode 100644
--- /dev/null	(date 1741937813122)
+++ b/secrets.yaml	(date 1741937813122)
@@ -0,0 +1,17 @@
+# 1. Create a Namespace for isolation
+apiVersion: v1
+kind: Namespace
+metadata:
+  name: card-app-namespace
+---
+
+# 2. Create a Secret in the correct namespace
+apiVersion: v1
+kind: Secret
+metadata:
+  name: mysql-secret
+  namespace: card-app-namespace  # âœ… Add this line to assign the secret to the namespace
+type: Opaque
+data:
+  username: cm9vdA==
+  password: cm9vdFBhc3N3b3Jk
Index: app.yaml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app.yaml b/app.yaml
--- a/app.yaml	(revision 90ab50ff4f539137a8e369097375a1a7094dbdf0)
+++ b/app.yaml	(date 1741938061205)
@@ -27,13 +27,25 @@
            - containerPort: 8081
          env:
            - name: DB_HOST
-             value: mysql-service
+             valueFrom:
+               configMapKeyRef:
+                 name: db-config
+                 key: host
            - name: DB_NAME
-             value: unibank
+             valueFrom:
+               configMapKeyRef:
+                 name: db-config
+                 key: dbName
            - name: DB_USERNAME
-             value: root
+             valueFrom:
+               secretKeyRef:
+                 name: mysql-secret
+                 key: username
            - name: DB_PASSWORD
-             value: rootPassword
+             valueFrom:
+               secretKeyRef:
+                 name: mysql-secret
+                 key: password
 ---
 apiVersion: v1
 kind: Service
